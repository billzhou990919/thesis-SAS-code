///// getting all drug files /////
proc sql;
    create table mscan.comedication2010 as
    select enrolid, svcdate, ndcnum from source.ccaed103
    where enrolid in (select enrolid from mscan.analytical_cohort);
quit;

proc sql;
    create table mscan.comedication2011 as
    select enrolid, svcdate, ndcnum from source.ccaed112
    where enrolid in (select enrolid from mscan.analytical_cohort);
quit;

proc sql;
    create table mscan.comedication2012 as
    select enrolid, svcdate, ndcnum from source.ccaed121
    where enrolid in (select enrolid from mscan.analytical_cohort);
quit;

proc sql;
    create table mscan.comedication2013 as
    select enrolid, svcdate, ndcnum from source.ccaed131
    where enrolid in (select enrolid from mscan.analytical_cohort);
quit;

proc sql;
    create table mscan.comedication2014 as
    select enrolid, svcdate, ndcnum from source.ccaed141
    where enrolid in (select enrolid from mscan.analytical_cohort);
quit;


proc sql;
    create table mscan.comedication2015 as
    select enrolid, svcdate, ndcnum from source.ccaed151
    where enrolid in (select enrolid from mscan.analytical_cohort);
quit;

proc sql;
    create table mscan.comedication2016 as
    select enrolid, svcdate, ndcnum from source.ccaed161
    where enrolid in (select enrolid from mscan.analytical_cohort);
quit;

proc sql;
    create table mscan.comedication2017 as
    select enrolid, svcdate, ndcnum from source.ccaed171
    where enrolid in (select enrolid from mscan.analytical_cohort);
quit;

proc sql;
    create table mscan.comedication2018 as
    select enrolid, svcdate, ndcnum from source.ccaed181
    where enrolid in (select enrolid from mscan.analytical_cohort);
quit;

proc sql;
    create table mscan.comedication2019 as
    select enrolid, svcdate, ndcnum from source.ccaed192
    where enrolid in (select enrolid from mscan.analytical_cohort);
quit;
/////////////////////


Data mscan.comedication;
Set mscan.comedication2010 mscan.comedication2011 mscan.comedication2012 mscan.comedication2013 mscan.comedication2014 mscan.comedication2015 mscan.comedication2016 mscan.comedication2017 
Mscan.comedication2018  mscan.comedication2019;
run;

////getting all co-medications 3 months prior to day0 or within the concomitant period/////
proc sql;
    create table mscan.comedication_final as
    select a.enrolid, a.day0, a.censor_date, b.svcdate, b.ndcnum
    from mscan.analytical_cohort as a
    left join mscan.comedication as b
    on a.enrolid = b.enrolid
    where (a.day0-90) <= b.svcdate < a.censor_date;
    /*where (0 <= (a.day0 - b.svcdate) <= 90) or (a.day0 <= b.svcdate < a.censor_date);*/

quit;

